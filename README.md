## Analysis of the recombination events using shared k-mers

This package aims to predict recombination events of the query gene(s) relative to the reference genes. The recombination events are estimated using the shared k-mers between the query and the reference genes. Here, we assume that none of the shared k-mers is derived from mutation. Therefore, if the adjacent shared k-mers in query gene are located in two different reference gene, there is one recombination event between the two reference genes to make the two k-mers together in the query gene. 

Functions:

- gen_ref_gene_dict(fn: str , window: int)
  - return kmer_reference_dictionary, reference_id_dictionary

- determine_recombine_bidirect(seq: str,  rkmer_dict: dict,  window:int )
  - return assigned_region, score_current_assign, score_previous_assign (see below)

Procedure of the analysis

1. Perform k-mer counting in the reference sequences. Assign each reference gene to one reference id, and generate the k-mer-to-reference_ids dictionary. Let the number of references = num_ref, the value of each k-mer in the dictionary is one bitarray with length = num_ref. The bit in this array records whether the k-mer is located in the corresponding reference.
2. Bidirectional sequence assignment of the query sequence.
   1. Initiate forward region assignment list as empty list.
   2. Initiate region start, region assignment are -1, bitarray of all 0 with length=num_ref, respectively.
   3. Read k-mer from the beginning of the sequence, update region start and assignment to the query location and the reference bitarru of the first k-mer shared with reference.
   4. Proceed to read k-mers, skip k-mers that are not in the reference dictionary.
   5. Make the intersect of the reference bitarray of the current shared k-mer with the assignment bitarray.
      - If the intersect = all zero, append the current region with region start and region assignment bitarray to forward assignment; initiate a new region with start=kmer location, assignment=kmer-to-reference assignment.
      - Otherwise update the region assignment to be the intersect.
   6. Generate forward region assignments repeating 4 until reaching the end of the query. Append the current region to forward region assignment list.
   7. Initiate the backward region assignment list as empty list.
   8. Perform similar procedure of 2-6, but read k-mers from the end of the query
   9. Merge the forward and backward region assignments
      - Plane-sweeping algorithm to merge assignments in both directions
      - Regions assigned to the same references are minimum recombination regions that derive from the reference genes.
      - Regions assigned to different references are homologous regions of the recombination events.
   10. Generate the list of assigned regions, assigned_region
       - assgined_region[0]: bitarray storing all the assigned reference_ids
       - assigned_region[i] (i > 0): [start: int, end: int, assignment: list]
         - assignment = [assignment: bitarray, None] for recombined regions
         - assignment = [forward_assignment: bitarray, backward_assignment: bitarray] for homologous regions
   11. Quality check of the assigned regions
       - Count shared k-mers of the in each region to estimate the conserved region after recombination
         - For example, if all the shared k-mers in one region are not shared with the reference assigned to the previous region, this region is the result of recombination with extremely high confidence; on the other hand, if all but one k-mer are shared with the previous reference, i.e., only one k-mer is specific to the current reference, this region is more likely to generated by mutation, rather than recombination

   12. Return the region assignment, the ratio of shared k-mers to all the k-mers in each region, the number of shared k-mers in each region


